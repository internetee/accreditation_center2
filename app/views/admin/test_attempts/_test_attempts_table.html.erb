<table>
  <tr>
    <td>
      <%= sanitize pagy_info(@pagy, item_name: t('.items', count: @pagy.count)) %>
    </td>
  </tr>
</table>
<table class="table">
  <thead>
    <tr>
      <th><%= t('.user') %></th>
      <th><%= t('.started_at') %></th>
      <th><%= t('.completed_at') %></th>
      <th><%= t('.duration') %></th>
      <th><%= t('.score') %></th>
      <th><%= t('.status') %></th>
      <th class="table--action"><%= t('.actions') %></th>
    </tr>
  </thead>
  <tbody>
    <% @test_attempts.each do |attempt| %>
      <tr>
        <td>
          <div class="user-info">
            <span class="user-name"><%= attempt.user.username %></span>
            [<span class="user-email"><%= attempt.user.email %></span>]
          </div>
        </td>
        <td><%= l(attempt.started_at, format: :short) if attempt.started_at %></td>
        <td><%= l(attempt.completed_at, format: :short) if attempt.completed_at %></td>
        <td>
          <% if attempt.completed? && attempt.started_at %>
            <%= distance_of_time_in_words(attempt.started_at, attempt.completed_at) %>
          <% elsif attempt.time_expired? && !attempt.completed? %>
            <%= t('.time_expired') %>
          <% elsif attempt.in_progress? %>
            <%= distance_of_time_in_words(attempt.started_at, Time.zone.now) %>
          <% else %>
            <%= t('.not_started') %>
          <% end %>
        </td>
        <td>
          <span class="score-value"><%= number_to_percentage(attempt.score_percentage, precision: 1) %></span>
        </td>
        <td>
          <% if attempt.passed? %>
            <span class="badge badge-success"><%= t('.passed') %></span>
          <% elsif attempt.failed? %>
            <span class="badge badge-danger"><%= t('.failed') %></span>
          <% elsif attempt.not_started? %>
            <span class="badge badge-warning"><%= t('.not_started') %></span>
          <% else %>
            <span class="badge badge-warning"><%= t('.in_progress') %></span>
          <% end %>
        </td>
        <td class="table--action">
          <%#= icon_link_to 'fas fa-eye', admin_test_test_attempt_path(@test, attempt), class: 'simple_tooltip', data: { 'tippy-content': t(:view) } %>
          
          <% if attempt.failed? || attempt.time_expired? %>
            <%= icon_link_to 'fas fa-redo', reassign_admin_test_test_attempt_path(@test, attempt), 
                class: 'simple_tooltip', 
                data: { 'tippy-content': t('.reassign_test'), turbo: true, turbo_method: :post, turbo_confirm: t('.confirm_reassign') } %>
            
            <%= icon_link_to 'fas fa-trash-alt', admin_test_test_attempt_path(@test, attempt), 
                class: 'simple_tooltip', 
                data: { 'tippy-content': t('.remove_assignment'), turbo: true, turbo_method: :delete, turbo_confirm: t('.confirm_remove_assignment') } %>
          <% end %>
          
          <% if attempt.in_progress? && !attempt.time_expired? %>
            <%= icon_link_to 'fas fa-clock', extend_time_admin_test_test_attempt_path(@test, attempt), 
                class: 'simple_tooltip', 
                data: { 'tippy-content': t('.extend_time'), turbo: true, turbo_method: :patch, turbo_confirm: t('.confirm_extend_time') } %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>