<% content_for(:title) { "EIS | #{t('.title')}" } %>
<% content_for :hero do %>
  <div class="layout--hero">
    <h1><%= t('.title') %></h1>
    <div class="monospace">
      <%= @user.username %> - <%= @user.email %>
    </div>
    <%= back_link(text: t('.back_to_users'), path: admin_users_path) %>
  </div>
<% end %>

<div class="page page--admin-user-detail">
  <div class="page--header">
    <div class="wrapper">
      <div class="row center-xs">
      </div>
    </div>
  </div>

  <div class="wrapper">
    <div class="row ">
      <div class="col-md-4 col-xs-12">
        <div class="paper">
          <div class="paper--header">
            <h3><%= t('.user_information') %></h3>
          </div>
          <div class="paper--content">
            <div class="summary-stats">
              <div class="stat-item">
                <span class="stat-label"><%= t('.username') %></span>
                <span class="stat-value"><%= @user.username %></span>
              </div>
              <div class="stat-item">
                <span class="stat-label"><%= t('.email') %></span>
                <span class="stat-value"><%= mail_to @user.email %></span>
              </div>
              <div class="stat-item">
                <span class="stat-label"><%= t('.registrar_name') %></span>
                <span class="stat-value"><%= @user.registrar_name.presence || '-' %></span>
              </div>
              <div class="stat-item">
                <span class="stat-label"><%= t('.role') %></span>
                <span class="stat-value"><%= @user.role %></span>
              </div>
              <div class="stat-item">
                <span class="stat-label"><%= t('.accreditation_status') %></span>
                <span class="stat-value">
                  <% if @user.accreditation_expire_date.present? %>
                    <% if @user.accreditation_expired? %>
                      <span class="badge badge-danger"><%= t('admin.dashboard.accreditation_expires') %>: <%= l(@user.accreditation_expire_date.to_date) %> (<%= t('admin.test_attempts.show.failed') %>)</span>
                    <% elsif @user.accreditation_expires_soon?(30) %>
                      <span class="badge badge-warning"><%= t('admin.dashboard.accreditation_expires') %>: <%= l(@user.accreditation_expire_date.to_date) %></span>
                    <% else %>
                      <span class="badge badge-success"><%= l(@user.accreditation_expire_date.to_date) %></span>
                    <% end %>
                  <% else %>
                    <span class="badge badge-default">-</span>
                  <% end %>
                </span>
              </div>
            </div>
          </div>
        </div>

        <div class="paper" style="margin-top: 20px;">
          <div class="paper--header">
            <h3><%= t('.statistics') %></h3>
          </div>
          <div class="paper--content">
            <div class="summary-stats">
              <div class="stat-item">
                <span class="stat-label"><%= t('.total_attempts') %></span>
                <span class="stat-value"><%= @statistics[:total] %></span>
              </div>
              <div class="stat-item">
                <span class="stat-label"><%= t('.passed_attempts') %></span>
                <span class="stat-value"><%= @statistics[:passed] %></span>
              </div>
              <div class="stat-item">
                <span class="stat-label"><%= t('.failed_attempts') %></span>
                <span class="stat-value"><%= @statistics[:failed] %></span>
              </div>
              <div class="stat-item">
                <span class="stat-label"><%= t('.success_rate') %></span>
                <span class="stat-value"><%= number_to_percentage(@statistics[:success_rate], precision: 1) %></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-8 col-xs-12">
        <div class="paper">
          <div class="paper--header">
            <h3><%= t('.attempts') %></h3>
          </div>
          <div class="paper--content">
            <% if @test_attempts.any? %>
              <%= render 'admin/users/test_attempts_table' %>
              <%= render partial: 'common/pagination', locals: { pagy: @pagy } if @test_attempts.count.positive? %>
            <% else %>
              <p><%= t('.no_attempts') %></p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

