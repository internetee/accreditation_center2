<% content_for(:title) { "EIS | #{t('.title')}" } %>
<% content_for :hero do %>
    <div class="layout--hero">
        <h1><%= t('.title') %></h1>
    </div>
<% end %>

<div class="page page--admin-dashboard">
  <div class="page--content">
    <div class="wrapper">
      <div class="admin-dashboard">

        <!-- Quick Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-clipboard-list"></i>
            </div>
            <div class="stat-content">
              <h3><%= Test.count %></h3>
              <p><%= t('admin.dashboard.total_tests') %></p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
              <h3><%= User.count %></h3>
              <p><%= t('admin.dashboard.total_users') %></p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-play-circle"></i>
            </div>
            <div class="stat-content">
              <h3><%= TestAttempt.count %></h3>
              <p><%= t('admin.dashboard.total_attempts') %></p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-trophy"></i>
            </div>
            <div class="stat-content">
              <h3><%= TestAttempt.where(passed: true).count %></h3>
              <p><%= t('admin.dashboard.passed_attempts') %></p>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
          <h2><%= t('admin.dashboard.quick_actions') %></h2>
          <div class="actions-grid">
            <%= link_to admin_tests_path, class: 'action-card' do %>
              <i class="fas fa-clipboard-list"></i>
              <h3><%= t('admin.dashboard.manage_tests') %></h3>
              <p><%= t('admin.dashboard.manage_tests_desc') %></p>
            <% end %>

            <%= link_to admin_users_path, class: 'action-card' do %>
              <i class="fas fa-users"></i>
              <h3><%= t('admin.dashboard.manage_users') %></h3>
              <p><%= t('admin.dashboard.manage_users_desc') %></p>
            <% end %>

            <%= link_to admin_test_attempts_path, class: 'action-card' do %>
              <i class="fas fa-chart-bar"></i>
              <h3><%= t('admin.dashboard.view_results') %></h3>
              <p><%= t('admin.dashboard.view_results_desc') %></p>
            <% end %>

            <%= link_to new_admin_test_path, class: 'action-card' do %>
              <i class="fas fa-plus-circle"></i>
              <h3><%= t('admin.dashboard.create_test') %></h3>
              <p><%= t('admin.dashboard.create_test_desc') %></p>
            <% end %>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="recent-activity">
          <h2><%= t('admin.dashboard.recent_activity') %></h2>
          
          <div class="activity-section">
            <h3><%= t('admin.dashboard.recent_test_attempts') %></h3>
            <div class="activity-list">
              <% TestAttempt.includes(:user, :test).order(created_at: :desc).limit(5).each do |attempt| %>
                <div class="activity-item">
                  <div class="activity-icon <%= attempt.passed? ? 'success' : 'danger' %>">
                    <i class="fas fa-<%= attempt.passed? ? 'check' : 'times' %>"></i>
                  </div>
                  <div class="activity-content">
                    <p>
                      <strong><%= attempt.user.username %></strong> 
                      <%= t('admin.dashboard.attempted') %> 
                      <strong><%= attempt.test.title %></strong>
                    </p>
                    <small><%= time_ago_in_words(attempt.created_at) %> <%= t('ago') %></small>
                  </div>
                  <div class="activity-score">
                    <%= attempt.score_percentage %>%
                  </div>
                </div>
              <% end %>
            </div>
          </div>

          <div class="activity-section">
            <h3><%= t('admin.dashboard.expiring_accreditations') %></h3>
            <div class="activity-list">
              <% User.joins(:test_attempts).where(test_attempts: { passed: true })
                      .where('test_attempts.created_at < ?', 11.months.ago)
                      .distinct.limit(5).each do |user| %>
                <div class="activity-item">
                  <div class="activity-icon warning">
                    <i class="fas fa-clock"></i>
                  </div>
                  <div class="activity-content">
                    <p>
                      <strong><%= user.username %></strong> 
                      <%= t('admin.dashboard.accreditation_expires') %>
                    </p>
                    <small><%= user.days_until_accreditation_expiry %> <%= t('days') %></small>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .admin-dashboard {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }
  
  .page-header {
    text-align: center;
    margin-bottom: 40px;
  }
  
  .page-header h1 {
    color: #333;
    margin-bottom: 10px;
  }
  
  .page-header p {
    color: #666;
    font-size: 1.1em;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
  }
  
  .stat-card {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    display: flex;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .stat-icon {
    font-size: 2em;
    color: #007bff;
    margin-right: 15px;
  }
  
  .stat-content h3 {
    margin: 0;
    font-size: 2em;
    color: #333;
  }
  
  .stat-content p {
    margin: 5px 0 0 0;
    color: #666;
  }
  
  .quick-actions {
    margin-bottom: 40px;
  }
  
  .quick-actions h2 {
    margin-bottom: 20px;
    color: #333;
  }
  
  .actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
  }
  
  .action-card {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    text-decoration: none;
    color: inherit;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .action-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    text-decoration: none;
    color: inherit;
  }
  
  .action-card i {
    font-size: 2em;
    color: #007bff;
    margin-bottom: 15px;
  }
  
  .action-card h3 {
    margin: 0 0 10px 0;
    color: #333;
  }
  
  .action-card p {
    margin: 0;
    color: #666;
  }
  
  .recent-activity {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
  }
  
  .recent-activity h2 {
    margin-bottom: 20px;
    color: #333;
  }
  
  .activity-section {
    margin-bottom: 30px;
  }
  
  .activity-section:last-child {
    margin-bottom: 0;
  }
  
  .activity-section h3 {
    margin-bottom: 15px;
    color: #555;
    font-size: 1.1em;
  }
  
  .activity-item {
    display: flex;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .activity-item:last-child {
    border-bottom: none;
  }
  
  .activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    font-size: 1.2em;
  }
  
  .activity-icon.success {
    background: #d4edda;
    color: #155724;
  }
  
  .activity-icon.danger {
    background: #f8d7da;
    color: #721c24;
  }
  
  .activity-icon.warning {
    background: #fff3cd;
    color: #856404;
  }
  
  .activity-content {
    flex: 1;
  }
  
  .activity-content p {
    margin: 0;
    color: #333;
  }
  
  .activity-content small {
    color: #666;
  }
  
  .activity-score {
    font-weight: bold;
    color: #007bff;
  }
</style> 