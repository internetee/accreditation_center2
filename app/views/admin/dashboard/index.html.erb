<% content_for(:title) { "EIS | #{t('.title')}" } %>
<% content_for :hero do %>
  <div class="layout--hero">
    <h1><%= t('.title') %></h1>
  </div>
<% end %>

<div class="page page--admin-dashboard">
  <div class="page--header">
    <div class="wrapper">
      <div class="row center-xs">
        <div class="col-xs-auto">
          <%= link_to t('admin.dashboard.create_test'), new_admin_test_path, class: 'button button--secondary' %>
        </div>
      </div>
    </div>
  </div>

  <div class="wrapper">
    <div class="row">
      <div class="col-md-12 col-xs-12">
        <div class="paper">
          <div class="paper--content">
            <div class="stats-grid">
              <div class="stat-item">
                <span class="stat-label"><%= t('admin.dashboard.total_tests') %></span>
                <span class="stat-value"><%= link_to_if Test.count.positive?, Test.count, admin_tests_path %></span>
              </div>
              <div class="stat-item">
                <span class="stat-label"><%= t('admin.dashboard.total_users') %></span>
                <span class="stat-value"><%= link_to_if User.not_admin.count.positive?, User.not_admin.count, admin_users_path %></span>
              </div>
              <div class="stat-item">
                <span class="stat-label"><%= t('admin.dashboard.total_attempts') %></span>
                <span class="stat-value"><%= TestAttempt.count %></span>
              </div>
              <div class="stat-item">
                <span class="stat-label"><%= t('admin.dashboard.passed_attempts') %></span>
                <span class="stat-value"><%= TestAttempt.where(passed: true).count %></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="wrapper">
    <div class="page--header">
      <h2><%= t('admin.dashboard.recent_activity') %></h2>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th><%= t('admin.dashboard.activity') %></th>
          <th><%= t('admin.dashboard.score') %></th>
          <th><%= t('admin.dashboard.date') %></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @recent_activity.each do |attempt| %>
          <tr>
            <td><strong><%= link_to attempt.user.username, admin_user_path(attempt.user) %></strong> <%= t('admin.dashboard.attempted') %> <strong><%= link_to attempt.test.title, admin_test_path(attempt.test) %></strong></td>
            <td><%= attempt.score_percentage %>%</td>
            <td><%= l(attempt.created_at, format: :long) %></td>
            <td>
              <%= icon_link_to 'fas fa-eye',
                  admin_test_test_attempt_path(attempt.test, attempt),
                  class: 'simple_tooltip',
                  data: { 'tippy-content': t(:view), turbo: false } %>
            </td>
          </tr>
        <% end %>
        <tr>
          <td colspan="3">
          </td>
        </tr>
      </tbody>
    </table>
  </div>



  <div class="wrapper">
    <div class="page--header">
      <h2><%= t('admin.dashboard.expiring_accreditations') %></h2>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th><%= t('admin.dashboard.user') %></th>
          <th><%= t('admin.dashboard.days_until_expiry') %></th>
        </tr>
      </thead>
      <tbody>
        <% @expiring_accreditations.each do |user| %>
          <tr>
            <td><strong><%= link_to user.username, admin_user_path(user) %></strong> <%= t('admin.dashboard.accreditation_expires') %></td>
            <td><%= user.days_until_accreditation_expiry %> <%= t('days') %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>